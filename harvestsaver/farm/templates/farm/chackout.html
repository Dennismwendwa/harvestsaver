{% extends "accounts/layout.html" %}
{% load static %}
{% load humanize %}

{% block title %}
HarvestSaver â€“ Checkout
{% endblock %}

{%block javascript%}
<script src="{% static 'assets/js/checkout.js' %}"></script>
{%endblock%}

{% block category %}
<section class="py-4 mt-2">
    <div class="container">
        <form action="{% url 'farm:checkout' %}" method="post">
            {% csrf_token %}

            <div class="row g-4">

                <!-- LEFT: CHECKOUT FORM -->
                <div class="col-md-8">

                    <!-- Shipping Address -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="mb-3">1. Shipping Address</h4>

                            <div class="mb-3">
                                <label class="form-label">Delivery Address</label>
                                <textarea
                                    name="address"
                                    class="form-control"
                                    rows="4"
                                    placeholder="Enter full shipping address (landmarks, phone contact, notes...)"
                                    required
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="mb-3">2. Payment Method</h4>

                            <div class="mb-3">
                                <select id="paymentMethod" name="payment_method" class="form-select" required>
                                    <option value="" disabled selected>Select Payment Method</option>
                                    <option value="mpesa">M-Pesa</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="pay_on_delivery">Pay on Delivery</option>
                                </select>
                            </div>

                            <!-- M-Pesa Form -->
                            <div id="mpesaForm" class="d-none mt-3">
                                <label class="form-label">M-Pesa Phone Number</label>
                                <input
                                    type="text"
                                    name="mpesa_number"
                                    class="form-control"
                                    placeholder="e.g. 07XXXXXXXX"
                                >
                            </div>

                            <!-- Bank Transfer Form -->
                            <div id="bankForm" class="d-none mt-3">
                                <label class="form-label">Bank Name</label>
                                <input
                                    type="text"
                                    name="bank_name"
                                    class="form-control"
                                    placeholder="Enter your bank name"
                                >
                                <label class="form-label mt-2">Account Number</label>
                                <input
                                    type="text"
                                    name="account_number"
                                    class="form-control"
                                    placeholder="Enter your account number"
                                >
                            </div>

                        </div>
                    </div>

                    <!-- Transport -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="mb-3">
                                3. Transport Method
                                <span class="badge bg-danger">Farm Transit</span>
                            </h4>

                            <div class="form-check mb-2">
                                <input
                                    class="form-check-input"
                                    type="radio"
                                    name="transport_option"
                                    value="Express Delivery"
                                    required
                                >
                                <label class="form-check-label">
                                    Express Delivery
                                </label>
                            </div>

                            <div class="form-check mb-3">
                                <input
                                    class="form-check-input"
                                    type="radio"
                                    name="transport_option"
                                    value="Standard Delivery"
                                >
                                <label class="form-check-label">
                                    Standard Delivery
                                </label>
                            </div>

                            <div>
                                <label class="form-label">Pickup Location</label>
                                <input
                                    type="text"
                                    name="pickup_location"
                                    class="form-control"
                                    placeholder="Where goods should be picked from"
                                    required
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Submit -->
                    <div class="text-center">
                        <button class="btn btn-success btn-lg px-5" type="submit">
                            Checkout
                        </button>
                    </div>
                </div>

                <!-- RIGHT: ORDER SUMMARY -->
                <div class="col-md-4">
                    <div class="card shadow-sm">
                        <div class="card-body">

                            <h4 class="text-center mb-3">Order Summary</h4>

                            <div class="d-flex justify-content-between">
                                <span>Items</span>
                                <strong>Ksh {{ total|floatformat:2|intcomma }}</strong>
                            </div>

                            <div class="d-flex justify-content-between">
                                <span>Shipping (3%)</span>
                                <strong>Ksh {{ shipping|floatformat:2|intcomma }}</strong>
                            </div>

                            <hr>

                            <div class="d-flex justify-content-between">
                                <span class="fw-bold text-danger">Total</span>
                                <span class="fw-bold text-danger">
                                    Ksh {{ total_cost|floatformat:2|intcomma }}
                                </span>
                            </div>

                            <hr>

                            <div class="alert alert-info text-center mb-0">
                                Track your goods easily using <strong>Farm Transit</strong>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </div>
</section>
{% endblock %}
